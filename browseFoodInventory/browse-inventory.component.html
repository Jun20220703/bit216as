<div class="layout">
  <!-- Sidebar -->
  <app-sidebar></app-sidebar>

  <!-- Main content -->
  <div class="content">
    <!-- Header -->
    <header class="inventory-header">
      <div class="inventory-title">
        <label>Inventory</label>
        <div class="select-wrapper">
          <select [(ngModel)]="selectedLocation">
            <option *ngFor="let loc of locations" [value]="loc">{{ loc }}</option>
          </select>
          <span class="custom-arrow">▼</span>
        </div>
      </div>

      <div class="header-icons">
        <i class="fa-solid fa-magnifying-glass header-icon" (click)="toggleSearchBar()"></i>
        <i class="fa-solid fa-sliders header-icon" (click)="toggleFilterPanel()"></i>
      </div>
    </header>

    <!-- Search bar -->
    <div *ngIf="showSearch" class="search-bar">
      <input type="text" [(ngModel)]="searchQuery" placeholder="Search food items..." />
    </div>

    <!-- Filter Drawer -->
    <div class="filter-drawer" [class.open]="showFilter">
      <div class="filter-header">
        <h2>Filters</h2>
        <button class="close-btn" (click)="toggleFilterPanel()">×</button>
      </div>

      <div class="filter-section">
        <h3>Source</h3>
        <label>
          <input type="radio" name="source" [checked]="filter.inventory" (change)="toggleSource('inventory')" />
          Inventory only
        </label>
        <label>
          <input type="radio" name="source" [checked]="filter.donation" (change)="toggleSource('donation')" />
          Donation List
        </label>
      </div>

      <div class="filter-section">
        <h3>Category</h3>
        <label><input type="checkbox" [checked]="filter.categories.all" (change)="toggleCategory('all')" /> All</label>
        <label><input type="checkbox" [checked]="filter.categories.fruit" (change)="toggleCategory('fruit')" /> Fruit</label>
        <label><input type="checkbox" [checked]="filter.categories.vegetable" (change)="toggleCategory('vegetable')" /> Vegetable</label>
        <label><input type="checkbox" [checked]="filter.categories.meat" (change)="toggleCategory('meat')" /> Meat</label>
        <label><input type="checkbox" [checked]="filter.categories.carb" (change)="toggleCategory('carb')" /> Carbohydrates</label>
      </div>

      <div class="filter-section">
        <h3>Expired in</h3>
        <input type="number" [(ngModel)]="filter.expiredIn" />
        <span> day(s)</span>
      </div>
    </div>


    <!-- Location & Category List -->
    <div *ngFor="let loc of filteredLocations()" class="location-block">
      <!-- 只有 All 才显示 Location 大标题 -->
      <h1 *ngIf="selectedLocation === 'All'" class="location-title">{{ loc.name }}</h1>

      <!-- Category -->
      <div *ngFor="let category of loc.categories" class="category" [ngClass]="category.colorClass">
        <h2>{{ category.icon }} {{ category.name }}</h2>

        <!-- Item -->
        <div *ngFor="let item of category.items"
             class="item"
             (mouseenter)="hoverItem = item"
             (mouseleave)="hoverItem = null">
          
          <!-- 左：名称 -->
          <div class="item-name">{{ item.name }}</div>

          <!-- 中：数量 -->
          <div class="quantity-slot">
            <div class="quantity-control" role="group">
              <button (click)="decreaseItem(item)">-</button>
              <span class="qty">{{ item.quantity }}</span>
              <button (click)="increaseItem(item)">+</button>
            </div>
          </div>

          <!-- 右：hover 动作 -->
          <div class="hover-slot">
            <div class="hover-actions" [class.visible]="hoverItem === item">
              <button class="used">Used</button>
              <button class="meal">Meal</button>
              <button class="donate">Donate</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
